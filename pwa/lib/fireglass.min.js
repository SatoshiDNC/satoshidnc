/*
 * FireGlass UI Framework tbd 
 * Copyright (C) 2023-2024 by Contributors
 * 
 * Satoshi Fairware License
 * 
 * This license requires paying one's fair share to the project contributors in
 * exchange for GPL-like rights. See https://satoshidnc.com/licenses for the
 * full license text and to calculate and pay your fair share.
 * 
 * This text pointing to the license must accompany the software.
 */
var FireGlass=function(){function N(){return 0<navigator.maxTouchPoints?85:5}function da(){if(T){var a=T,c;a.actionFlags&m.GAF_NUMINPUT&&(c=aa);a.actionFlags&m.GAF_TEXTINPUT&&(c=ba);c&&(c.blur(),c.style.display="none");T=void 0}}function ea(a){da();T=a;a.textBeginFunc&&a.textBeginFunc.call(a);a.actionFlags&m.GAF_GONEXT&&(fa.style.display="inline",ha.style.display="inline");let c;a.actionFlags&m.GAF_NUMINPUT&&(c=aa);a.actionFlags&m.GAF_TEXTINPUT&&(c=ba);c&&(c.value=a.text,c.style.display="inline",
c.focus(),c.select())}function xa(a){if(a!=ca){var c=0;0<ca&&(c=a-ca);ca=a;const b=[];for(;a=B.pop();)b.push(a);if(ia)ia=!1,k.viewport(0,0,w.width,w.height),mat4.identity(O),mat4.translate(O,O,[-1,1,0]),mat4.scale(O,O,[2/w.width,-2/w.height,1]),x&&(a=new m.LayoutState(w.width,w.height),x.layoutAll(a));else for(;a=b.pop();)a.relayout();ja&&(--ja||x.setRenderFlag(!0));ka&&x.setRenderFlag(!0);if(x&&(x.needsRender||x.childRender)){a=0;for(var [,d]of Object.entries(u))d.dx=(d.x-d.px)/c,d.px=d.x,d.dy=(d.y-
d.py)/c,d.py=d.y,a+=Math.sqrt(d.dx*d.dx+d.dy*d.dy)/ya;la&&la.setValueAtTime(a,G.currentTime);x.renderAll();if(za){k.viewport(0,0,w.width,w.height);k.disable(k.SCISSOR_TEST);k.useProgram(C);k.bindBuffer(k.ARRAY_BUFFER,ma);c=k.getAttribLocation(C,"aVertexPosition");k.vertexAttribPointer(c,2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(c);k.enable(k.BLEND);k.uniform4fv(k.getUniformLocation(C,"uVertexColor"),new Float32Array([1,1,1,1]));k.uniformMatrix4fv(k.getUniformLocation(C,"uProjectionMatrix"),!1,O);
c=mat4.create();if(ka){d=[];for(var [,f]of Object.entries(u))if(f.hitList){a=f.hitList.getActionableGads(m.GAF_ALL);for(const g of a)d.includes(g)||d.push(g)}for(const g of d)if(g.ownedBy){f=g.convexHull;for(p=0;p<f.length;p+=2)mat4.fromTranslation(c,[g.viewport.x,g.viewport.y,0]),mat4.mul(c,c,g.viewport.userMat),mat4.scale(c,c,[g.viewport.getScale(),g.viewport.getScale(),1]),mat4.translate(c,c,[g.x+f[p+0]-g.viewport.userX,g.y+f[p+1]-g.viewport.userY,0]),mat4.scale(c,c,[f[(p+2)%f.length]-f[p+0],f[(p+
3)%f.length]-f[p+1],1]),k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,z.unitLine,F.unitLine);f=vec3.create();mat4.getScaling(f,g.viewport.userMat)}for(const [,g]of Object.entries(u))mat4.identity(c),mat4.translate(c,c,[g.x,g.y,0]),k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c),"mouse"==g.e.pointerType?k.drawArrays(k.LINE_LOOP,z.roundMouse,F.roundMouse):k.drawArrays(k.LINE_LOOP,z.roundTouch,F.roundTouch)}na=(na+1)%16;mat4.identity(c);
mat4.translate(c,c,[160,45,0]);mat4.rotate(c,c,Math.PI/8*na,[0,0,1]);mat4.scale(c,c,[40,10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,10,0]);mat4.scale(c,c,[50,10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,25,0]);mat4.scale(c,c,[50*window.visualViewport.scale,
10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,40,0]);mat4.scale(c,c,[50*window.devicePixelRatio,10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,55,0]);mat4.scale(c,c,[50*window.innerWidth/1E3,10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),
!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);for(const [,g]of Object.entries(u))mat4.identity(c),mat4.translate(c,c,[12,57,0]),mat4.scale(c,c,[46*g.x/D/1E3,6,0]),k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);mat4.identity(c);mat4.translate(c,c,[10,70,0]);mat4.scale(c,c,[50*window.innerHeight/1E3,10,0]);k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c);k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare);
for(const [,g]of Object.entries(u))mat4.identity(c),mat4.translate(c,c,[12,72,0]),mat4.scale(c,c,[46*g.y/D/1E3,6,0]),k.uniformMatrix4fv(k.getUniformLocation(C,"uModelViewMatrix"),!1,c),k.drawArrays(k.LINE_LOOP,z.unitSquare,F.unitSquare)}}}window.requestAnimationFrame(xa)}function V(){ja=10;var a;if(oa&&pa){var c=oa;var d=pa;var f=a=1;w.width=c;w.height=d}else c=window.innerWidth,d=window.innerHeight,a=window.devicePixelRatio,f=window.visualViewport.scale,w.width=c*f*a,w.height=d*f*a;w.style.width=
`${c}px`;w.style.height=`${d}px`;ya=Math.sqrt(w.width*w.width+w.height*w.height);D=f*a;ia=!0;x.resizeFunc&&x.resizeFunc.call(x)}function K(a,c){function d(n,q){for(const r of n.hitList.hits)r.gad!==q&&r.gad.ownedBy==g&&(r.gad.gestureState+="-disowned",r.gad.viewport.setRenderFlag(!0),delete r.gad.ownedBy)}function f(n){const q=n.x-n.ox;n=n.y-n.oy;return q*q>n*n?0<q?"right":"left":0<n?"down":"up"}if("touches"==c&&a.touches&&0==a.touches.length){a=[];for(var [,b]of Object.entries(u))b.tempIsActive=
"mouse"==b.e.pointerType;for(const [n,q]of Object.entries(u))q.tempIsActive||a.push(n);for(;a.length;)delete u[a.pop()];for(const [,n]of Object.entries(u))delete n.tempIsActive}else{D!=window.visualViewport.scale*window.devicePixelRatio&&V();var g="p-"+a.pointerId;switch(c){case "down":da();u.hasOwnProperty(g)||(u[g]={gestureState:"",touching:!1,px:a.layerX*D,py:a.layerY*D});b=u[g];b.e=a;b.touching=!0;b.x=a.layerX*D;b.y=a.layerY*D;b.ox=b.x;b.oy=b.y;b.hitList=new m.HitList(b.x,b.y);x.getHits(b.hitList,
N());b.hitList.sortHits();if("mouse"==a.pointerType){if(0==a.button)for(const n of b.hitList.hits){var e=n.gad;!e.ownedBy&&e.actionFlags&m.GAF_CLICKABLE&&(e.gestureState="begin-click",e.ownedBy=g,e.viewport.setRenderFlag(!0));!e.ownedBy&&e.actionFlags&m.GAF_DRAGGABLE&&(e.gestureState="begin-drag",e.ownedBy=g,e.viewport.setRenderFlag(!0));!e.ownedBy&&e.actionFlags&(m.GAF_NUMINPUT|m.GAF_TEXTINPUT)&&(e.gestureState="begin-input",e.ownedBy=g,e.viewport.setRenderFlag(!0));e.gestureTimerId=setTimeout(K,
250,a,"drag time reached")}if(2==a.button)for(const n of b.hitList.hits)b=n.gad,!b.ownedBy&&b.actionFlags&m.GAF_CONTEXTMENU&&(b.gestureState="begin-menu",b.ownedBy=g,b.viewport.setRenderFlag(!0),W())}else{e=!1;for(const n of b.hitList.hits)(b=n.gad,b.ownedBy)?b.ownedBy!=g&&("await-pinch"==b.gestureState||b.actionFlags&m.GAF_PINCHABLE&&("begin-drag"==b.gestureState||"begin-tap"==b.gestureState)?(b.gestureState="pinch",b.secondTouch=g,b.viewport.setRenderFlag(!0),b.pinchBeginFunc&&b.pinchBeginFunc.call(b,
u[b.ownedBy],u[b.secondTouch])):"drag"==b.gestureState&&b.actionFlags&m.GAF_PINCHABLE&&(b.gestureState="pinch",b.secondTouch=g,b.viewport.setRenderFlag(!0),b.dragEndFunc&&b.dragEndFunc.call(b,u[b.ownedBy]),b.pinchBeginFunc&&b.pinchBeginFunc.call(b,u[b.ownedBy],u[b.secondTouch]))):b.actionFlags&m.GAF_CLICKABLE&&!e?(b.gestureState="begin-tap",b.ownedBy=g,e=!0,b.viewport.setRenderFlag(!0),b.gestureBeginTime=a.timeStamp,b.actionFlags&(m.GAF_CONTEXTMENU|m.GAF_HOLDABLE|m.GAF_DRAGGABLE)&&(b.gestureTimerId=
setTimeout(K,250,a,"tap-and-hold time reached"))):b.actionFlags&(m.GAF_NUMINPUT|m.GAF_TEXTINPUT)?(b.gestureState="begin-input",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureBeginTime=a.timeStamp,b.actionFlags&m.GAF_CONTEXTMENU&&(b.gestureTimerId=setTimeout(K,250,a,"tap-and-hold time reached"))):b.actionFlags&m.GAF_CONTEXTMENU?(b.gestureState="begin-menu",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(K,250,a,"tap-and-hold time reached")):b.actionFlags&m.GAF_HOLDABLE?(b.gestureState=
"begin-hold",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(K,250,a,"tap-and-hold time reached")):b.actionFlags&m.GAF_DRAGGABLE?(b.gestureState="begin-drag",b.ownedBy=g,b.viewport.setRenderFlag(!0),b.gestureTimerId=setTimeout(K,250,a,"drag time reached")):b.actionFlags&m.GAF_SWIPEABLE?(b.gestureState="begin-swipe",b.ownedBy=g,b.viewport.setRenderFlag(!0)):b.actionFlags&m.GAF_PINCHABLE&&(b.gestureState="await-pinch",b.ownedBy=g,b.viewport.setRenderFlag(!0))}break;case "move":qa||
"mouse"!=a.pointerType||(qa=1,x.enableMouse&&x.enableMouse.call(x));u.hasOwnProperty(g)||(u[g]={gestureState:"mouse"==a.pointerType?"hover":"",touching:"mouse"==a.pointerType?!1:!0});b=u[g];b.e=a;b.px=b.x;b.x=a.layerX*D;b.py=b.y;b.y=a.layerY*D;if("mouse"==a.pointerType){if(b.hitList)for(e of b.hitList.hits){var h=e.gad;if(h.ownedBy==g)switch(h.gestureState){case "begin-click":case "recover-click":a=new m.HitList(b.x,b.y);h.getHits(a,N());0==a.hits.length&&(h.gestureState="abandon-click",h.viewport.setRenderFlag(!0));
break;case "begin-input":a=new m.HitList(b.x,b.y);h.getHits(a,N());0==a.hits.length&&(h.gestureState="abandon-input",h.viewport.setRenderFlag(!0));break;case "hold":a=new m.HitList(b.x,b.y);h.getHits(a,N());0==a.hits.length&&(h.gestureState="abandon-hold",h.viewport.setRenderFlag(!0),h.holdEndFunc&&h.holdEndFunc.call(h,b));break;case "abandon-click":a=new m.HitList(b.x,b.y);h.getHits(a,N());0!=a.hits.length&&(h.gestureState="recover-click",h.viewport.setRenderFlag(!0));break;case "abandon-hold":a=
new m.HitList(b.x,b.y);h.getHits(a,N());0!=a.hits.length&&(h.gestureState="hold",h.viewport.setRenderFlag(!0),h.holdBeginFunc&&h.holdBeginFunc.call(h,b));break;case "begin-drag":a=f(b);Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(h.hasOwnProperty("gestureTimerId")&&(clearTimeout(h.gestureTimerId),delete h.gestureTimerId),("up"==a||"down"==a)&&h.actionFlags&m.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&h.actionFlags&m.GAF_DRAGGABLE_LEFTRIGHT)&&(h.gestureState="drag",h.viewport.setRenderFlag(!0),d(b,
h),h.dragBeginFunc&&h.dragBeginFunc.call(h,b),h.dragMoveFunc&&h.dragMoveFunc.call(h,b));break;case "drag":h.dragMoveFunc&&h.dragMoveFunc.call(h,b)}}}else for(h of b.hitList.hits)if(e=h.gad,e.ownedBy==g)switch(e.gestureState){case "begin-tap":if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.gestureState="invalid-tap",e.viewport.setRenderFlag(!0),!b.swiping))if(a=f(b),("up"==a||"down"==a)&&e.actionFlags&m.GAF_SWIPEABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&m.GAF_SWIPEABLE_LEFTRIGHT){e.gestureState=
"swipe";b.swiping=!0;e.viewport.setRenderFlag(!0);for(var l of b.hitList.hits)l.gad!==e&&l.gad.ownedBy==g&&delete l.gad.ownedBy;delete b.cancel;e.swipeBeginFunc&&e.swipeBeginFunc.call(e,b);b.cancel?e.gestureState="prog-cancel-swipe":(e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b),console.log("swipe "+a))}else if(("up"==a||"down"==a)&&e.actionFlags&m.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&m.GAF_DRAGGABLE_LEFTRIGHT)e.gestureState="drag",b.swiping=!0,e.viewport.setRenderFlag(!0),DisownAllOtherGags(b,
e),delete b.cancel,e.dragBeginFunc&&e.dragBeginFunc.call(e,b),b.cancel?e.gestureState="prog-cancel-drag":(e.dragMoveFunc&&e.dragMoveFunc.call(e,b),console.log("drag "+a));break;case "begin-input":Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),e.gestureState="invalid-input",e.viewport.setRenderFlag(!0));break;case "begin-menu":Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),
delete e.gestureTimerId),e.gestureState="invalid-menu",e.viewport.setRenderFlag(!0));break;case "begin-hold":Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),e.gestureState="invalid-hold",e.viewport.setRenderFlag(!0));break;case "begin-swipe":a=f(b);Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),!b.swiping&&(("up"==a||"down"==
a)&&e.actionFlags&m.GAF_SWIPEABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&m.GAF_SWIPEABLE_LEFTRIGHT)&&(e.gestureState="swipe",b.swiping=!0,e.viewport.setRenderFlag(!0),d(b,e),delete b.cancel,e.swipeBeginFunc&&e.swipeBeginFunc.call(e,b),b.cancel?e.gestureState="prog-cancel-swipe":e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b)));break;case "hold":a=new m.HitList(b.x,b.y);e.getHits(a,N());0==a.hits.length&&(e.gestureState="abandon-hold",e.viewport.setRenderFlag(!0),e.holdEndFunc&&e.holdEndFunc.call(e,
b));break;case "swipe":e.swipeMoveFunc&&e.swipeMoveFunc.call(e,b);break;case "begin-drag":a=f(b);if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)>Q&&(e.hasOwnProperty("gestureTimerId")&&(clearTimeout(e.gestureTimerId),delete e.gestureTimerId),!b.swiping&&(("up"==a||"down"==a)&&e.actionFlags&m.GAF_DRAGGABLE_UPDOWN||("left"==a||"right"==a)&&e.actionFlags&m.GAF_DRAGGABLE_LEFTRIGHT))){e.gestureState="drag";b.swiping=!0;e.viewport.setRenderFlag(!0);d(b,e);for(const n of b.hitList.hits)if(n.gad!==e&&n.gad.secondTouch==
g)switch(n.gad.gestureState){case "pinch":n.gad.gestureState="drag",delete n.gad.secondTouch,n.gad.viewport.setRenderFlag(!0),n.gad.pinchEndFunc&&n.gad.pinchEndFunc.call(n.gad),n.gad.dragBeginFunc&&n.gad.dragBeginFunc.call(n.gad,u[n.gad.ownedBy])}e.dragBeginFunc&&e.dragBeginFunc.call(e,b);e.dragMoveFunc&&e.dragMoveFunc.call(e,b)}break;case "drag":e.dragMoveFunc&&e.dragMoveFunc.call(e,b);break;case "pinch":e.pinchMoveFunc&&e.pinchMoveFunc.call(e,u[e.ownedBy],u[e.secondTouch])}else if(e.secondTouch==
g)switch(e.gestureState){case "pinch":e.pinchMoveFunc&&e.pinchMoveFunc.call(e,u[e.ownedBy],u[e.secondTouch])}break;case "up":u.hasOwnProperty(g)||(u[g]={gestureState:"",touching:!1,x:0,y:0,px:0,py:0});b=u[g];b.e=a;b.touching=!1;if("mouse"==a.pointerType){if(0==a.button&&(e=0,b.hitList))for(const n of b.hitList.hits)if(h=n.gad,h.ownedBy==g){if(!e)switch(h.gestureState){case "begin-click":case "recover-click":W();h.clickFunc&&h.clickFunc.call(h,b);e=1;break;case "begin-input":W();ea(h);e=1;break;case "hold":h.holdEndFunc&&
h.holdEndFunc.call(h,b);break;case "begin-drag":h.hasOwnProperty("gestureTimerId")&&(clearTimeout(h.gestureTimerId),delete h.gestureTimerId);break;case "drag":h.dragMoveFunc&&h.dragMoveFunc.call(h,b),h.dragEndFunc&&h.dragEndFunc.call(h,b)}delete h.gestureState;delete h.ownedBy;h.viewport.setRenderFlag(!0)}if(2==a.button)for(const n of b.hitList.hits)if(e=n.gad,e.ownedBy==g){switch(e.gestureState){case "begin-menu":e.contextMenuFunc&&e.contextMenuFunc.call(e,b)}delete e.gestureState;delete e.ownedBy;
e.viewport.setRenderFlag(!0)}delete b.hitList}else{e=0;for(const n of b.hitList.hits)if(l=n.gad,h=0,l.ownedBy==g){l.hasOwnProperty("gestureTimerId")&&(clearTimeout(l.gestureTimerId),delete l.gestureTimerId);if(!e)switch(l.gestureState){case "begin-tap":W();l.clickFunc&&l.clickFunc.call(l,b);e=1;break;case "begin-input":W();ea(l);e=1;break;case "hold":l.holdEndFunc&&l.holdEndFunc.call(l,b);break;case "tap-and-hold":console.log("tap-and-hold release");break;case "swipe":l.swipeMoveFunc&&l.swipeMoveFunc.call(l,
b);l.swipeEndFunc&&l.swipeEndFunc.call(l,b);break;case "drag":l.dragMoveFunc&&l.dragMoveFunc.call(l,b);l.dragEndFunc&&l.dragEndFunc.call(l,b);break;case "pinch":l.gestureState="drag",l.ownedBy=l.secondTouch,delete l.secondTouch,l.viewport.setRenderFlag(!0),l.pinchEndFunc&&l.pinchEndFunc.call(l),l.dragBeginFunc&&l.dragBeginFunc.call(l,u[l.ownedBy]),h=1}h||(delete l.gestureState,delete l.ownedBy,l.viewport.setRenderFlag(!0))}else if(l.secondTouch==g)switch(l.gestureState){case "pinch":l.gestureState=
"drag",delete l.secondTouch,l.viewport.setRenderFlag(!0),l.pinchEndFunc&&l.pinchEndFunc.call(l),l.dragBeginFunc&&l.dragBeginFunc.call(l,u[l.ownedBy])}}"touch"==a.pointerType&&delete u[g];delete b.swiping;break;case "wheel":u.hasOwnProperty(g)||(u[g]={gestureState:"",touching:!1,px:a.layerX*D,py:a.layerY*D});b=u[g];b.e=a;b.touching=!0;b.x=a.layerX*D;b.y=a.layerY*D;b.hitList=new m.HitList(b.x,b.y);x.getHits(b.hitList,N());b.hitList.sortHits();if("wheel"==a.type){e=0;for(const n of b.hitList.hits)h=
n.gad,e||h.ownedBy||(h.actionFlags&m.GAF_SCROLLABLE_UPDOWN?(b=u[g],b.e=a,b.x=a.layerX*D,b.ox=b.x,b.px=b.x,b.y=a.layerY*D,b.oy=b.y,b.py=b.y,delete b.cancel,h.swipeBeginFunc&&h.swipeBeginFunc.call(h,b),b.cancel||(b.dx=0,b.x=b.x,b.dy=.8*Math.sign(a.wheelDelta)*window.devicePixelRatio,b.y+=b.dy,h.swipeMoveFunc&&h.swipeMoveFunc.call(h,b),h.swipeEndFunc&&h.swipeEndFunc.call(h,b)),e=1):h.actionFlags&m.GAF_SCROLLABLE_LEFTRIGHT?(b=u[g],b.e=a,b.x=a.layerX*D,b.ox=b.x,b.px=b.x,b.y=a.layerY*D,b.oy=b.y,b.py=b.y,
delete b.cancel,h.swipeBeginFunc&&h.swipeBeginFunc.call(h,b),b.cancel||(b.dx=.8*Math.sign(a.wheelDelta)*window.devicePixelRatio,b.x+=b.dx,b.dy=0,b.y=b.y,h.swipeMoveFunc&&h.swipeMoveFunc.call(h,b),h.swipeEndFunc&&h.swipeEndFunc.call(h,b)),e=1):h.actionFlags&m.GAF_PINCHABLE&&(b=u[g],b.e=a,b.x=a.layerX*D,b.ox=b.x,b.px=b.x,b.y=a.layerY*D,b.oy=b.y,b.py=b.y,h.actionFlags&m.GAF_ROTATABLE&&a.altKey&&h.rotateFunc?h.rotateFunc.call(h,b,Math.sign(a.wheelDelta)):h.actionFlags&m.GAF_SCALABLE&&h.zoomFunc&&h.zoomFunc.call(h,
b,Math.sign(a.wheelDelta)),e=1))}break;case "drag time reached":u.hasOwnProperty(g)||(u[g]={gestureState:"",touching:!0});b=u[g];b.e=a;if(b.hitList)for(const n of b.hitList.hits)a=n.gad,a.ownedBy==g&&("begin-click"==a.gestureState&&a.actionFlags&m.GAF_HOLDABLE&&(a.gestureState="hold",a.viewport.setRenderFlag(!0),d(b,a),a.holdBeginFunc&&a.holdBeginFunc.call(a,b)),"begin-drag"!=a.gestureState||b.swiping||(a.gestureState="drag",b.swiping=!0,a.viewport.setRenderFlag(!0),d(b,a),a.dragBeginFunc&&a.dragBeginFunc.call(a,
b)),a.hasOwnProperty("gestureTimerId")&&delete a.gestureTimerId);break;case "tap-and-hold time reached":console.log("tap-and-hold time reached");u.hasOwnProperty(g)||(u[g]={gestureState:"",touching:!0});b=u[g];b.e=a;for(const n of b.hitList.hits)if(a=n.gad,a.ownedBy==g){if(Math.sqrt((b.ox-b.x)**2+(b.oy-b.y)**2)<=Q)switch(a.gestureState){case "begin-tap":case "begin-menu":case "begin-input":case "begin-swipe":case "begin-drag":case "begin-hold":if(a.actionFlags&m.GAF_CONTEXTMENU&&!b.swiping)a.gestureState=
"menu-hold",a.viewport.setRenderFlag(!0),d(b,a),a.contextMenuFunc&&a.contextMenuFunc.call(a,b);else if(a.actionFlags&m.GAF_HOLDABLE&&!b.swiping)a.gestureState="hold",console.log("hold"),a.viewport.setRenderFlag(!0),d(b,a),a.holdBeginFunc&&a.holdBeginFunc.call(a,b);else if(a.actionFlags&m.GAF_DRAGGABLE&&!b.swiping)a.gestureState="drag",b.swiping=!0,a.viewport.setRenderFlag(!0),d(b,a),a.dragBeginFunc&&a.dragBeginFunc.call(a,b);else if(a.actionFlags&m.GAF_SWIPEABLE&&!b.swiping){a.gestureState="swipe";
b.swiping=!0;a.viewport.setRenderFlag(!0);for(const q of b.hitList.hits)q.gad!==a&&q.gad.ownedBy==g&&delete q.gad.ownedBy;delete b.cancel;a.swipeBeginFunc&&a.swipeBeginFunc.call(a,b);b.cancel&&(a.gestureState="prog-cancel-swipe")}else a.gestureState="invalid-tap-and-hold",a.viewport.setRenderFlag(!0)}a.hasOwnProperty("gestureTimerId")&&delete a.gestureTimerId}}}}function Aa(a,c,d,f,b,g,e){w=a;oa=c;pa=d;ba=f;aa=b;fa=g;ha=e;k=w.getContext("webgl2",{antialias:!0,alpha:!1,desynchronized:!0,preserveDrawingBuffer:!0});
w.addEventListener("webglcontextlost",q=>{console.log("detected gl context lost");Android?.lostWebGL();q.preventDefault()},!1);w.addEventListener("webglcontextrestored",q=>{console.log("detected gl context restored");Android?.resetWebGL();Aa(w,ba,aa,fa,ha);Ba(x)},!1);var h=k.viewport.bind(k),l;k.viewport=function(q,r,t,v){l=[q,r,t,v];h(q,r,t,v)};var n=k.getParameter.bind(k);k.getParameter=function(q){return q==k.VIEWPORT&&l?l:n(q)}}function Ba(a,c){async function d(){if(0==e)G=new AudioContext,e=
1;else if(1==e){await G.audioWorklet.addModule("data:application/javascript;base64,"+btoa("\n            class AudioProcessor extends AudioWorkletProcessor {\n              constructor() {\n                super();\n                this.lastClick = 0;\n                this.wave = 0;\n                this.fx = 0;\n              }\n              process (inputs, outputs, parameters) {\n                const output = outputs[0];\n                output.forEach(channel => {\n                  for (var i = 0; i < channel.length; i++) {\n                    var sfx = 0;\n                    if (parameters['beep'][0] != this.fx) {\n                      this.fx = parameters['beep'][0];\n                      this.wave = 0;\n                    }\n                    switch (this.fx) {\n                      case 1:\n                        if (this.wave >= 200) this.wave = 0;\n                        sfx = this.wave >= 100? -0.1 : 0.1;\n                        break;\n                      case 2:\n                        if (this.wave >= 100) this.wave = 0;\n                        sfx = this.wave >= 50? -0.1 : 0.1;\n                        break;\n                      case 3:\n                        if (this.wave >= 50) this.wave = 0;\n                        sfx = this.wave >= 25? -0.1 : 0.1;\n                        break;\n                    }\n                    this.wave += 1;\n                    var wind = (Math.random() * 2 - 1)\n                      * (0.000 + (parameters['windspeed'][0]));\n                    channel[i] =\n                      wind +\n                      0.5 * (parameters['click'].length > 1 ? parameters['click'][i] : parameters['click'][0]) + sfx;\n                  }\n                });\n                return true;\n              }\n              static get parameterDescriptors() {\n                return [\n                  {\n                    name: \"windspeed\",\n                    automationRate: \"a-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                  {\n                    name: \"click\",\n                    automationRate: \"a-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                  {\n                    name: \"beep\",\n                    automationRate: \"k-rate\",\n                    defaultValue: 0,\n                    minValue: 0,\n                    maxValue: 1,\n                  },\n                ];\n              }\n            }\n            registerProcessor('audio-processor', AudioProcessor);\n\t\t\t\t"));
var h=G.createBufferSource();G.createScriptProcessor(2048);h.start();e=2}else 2==e&&(h=new AudioWorkletNode(G,"audio-processor"),h.connect(G.destination),ra=h.parameters.get("click"),P=h.parameters.get("beep"),la=h.parameters.get("windspeed"),e=3,g=!0)}if(k){var f=k.createShader(k.VERTEX_SHADER);k.shaderSource(f,"\n        attribute vec4 aVertexPosition;\n        uniform vec4 uVertexColor;\n        uniform mat4 uModelViewMatrix;\n        uniform mat4 uProjectionMatrix;\n        varying vec4 v_Color;\n        void main() {\n          gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n          v_Color = uVertexColor;\n        }\n\t");
k.compileShader(f);if(k.getShaderParameter(f,k.COMPILE_STATUS)){var b=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(b,"\n        varying lowp vec4 v_Color;\n        void main() {\n          gl_FragColor = v_Color;\n        }\n\t");k.compileShader(b);if(k.getShaderParameter(b,k.COMPILE_STATUS)&&(C=k.createProgram(),k.attachShader(C,f),k.attachShader(C,b),k.linkProgram(C),k.getProgramParameter(C,k.LINK_STATUS))){ma=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,ma);k.vertexAttribPointer(k.getAttribLocation(C,
"aVertexPosition"),2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(k.getAttribLocation(C,"aVertexPosition"));f=[];z.unitLine=f.length/2;f.splice(f.length,0,0,0,1,1);F.unitLine=f.length/2-z.unitLine;z.unitSquare=f.length/2;f.splice(f.length,0,1,1,0,1,0,0,1,0);F.unitSquare=f.length/2-z.unitSquare;z.roundTouch=f.length/2;for(b=0;36>b;b++)f.splice(f.length,0,85*Math.sin(b/18*Math.PI),85*Math.cos(b/18*Math.PI));F.roundTouch=f.length/2-z.roundTouch;z.squareTouch=f.length/2;f.splice(f.length,0,84.5,84.5,-84.5,
84.5,-84.5,-84.5,84.5,-84.5);F.squareTouch=f.length/2-z.squareTouch;z.roundMouse=f.length/2;for(b=0;36>b;b++)f.splice(f.length,0,5*Math.sin(b/18*Math.PI),5*Math.cos(b/18*Math.PI));F.roundMouse=f.length/2-z.roundMouse;z.squareMouse=f.length/2;f.splice(f.length,0,4.5,4.5,-4.5,4.5,-4.5,-4.5,4.5,-4.5);F.squareMouse=f.length/2-z.squareMouse;k.bufferData(k.ARRAY_BUFFER,new Float32Array(f),k.STATIC_DRAW);var g=!1,e=0;a&&(x=a);c&&(window.addEventListener("resize",function(h){V()},!1),V(),window.requestAnimationFrame(xa),
w.addEventListener("touchend",function(h){K(h,"touches")},!1),w.addEventListener("pointerdown",function(h){g||d();h.preventDefault();K(h,"down")},!1),w.addEventListener("pointermove",function(h){h.preventDefault();K(h,"move")},!1),w.addEventListener("pointerup",function(h){g||d();h.preventDefault();K(h,"up")},!1),w.addEventListener("contextmenu",function(h){h.preventDefault()},!1),w.addEventListener("wheel",function(h){h.preventDefault();K(h,"wheel")},!1),document.addEventListener("paste",function(h){var l=
T;l&&l.pasteFunc&&l.pasteFunc.call(l,h)}),document.addEventListener("keydown",function(h){var l=T;l&&l.keydownFunc&&l.keydownFunc.call(l,h)}))}}}}let m;var w,oa,pa,ba,aa,fa,ha,k;const z={},F={};var G,ra,P,la,ma,ya,D,ia;const B=[];const O=mat4.create();var qa=0,C,T,J,sa,ta,ua,va,wa;class Da{constructor(a,c){this.x=a;this.y=c;this.hits=[]}sortHits(){for(var a=[];0<this.hits.length;){var c=0,d=this.hits[0].dist,f,b=this.hits[0].gad.z?this.hits[0].gad.z:0,g;for(f=0;f<this.hits.length&&(g=this.hits[f].gad.z?
this.hits[f].gad.z:0,1);f++)if(g>b||g==b&&this.hits[f].dist<d)c=f,d=this.hits[f].dist,b=g;a.push(this.hits[c]);this.hits.splice(c,1)}this.hits=a}containsAny(a){for(var c=0;c<this.hits.length;c++)if(0!=(this.hits[c].gad.actionFlags&a))return!0;return!1}getActionableGads(a){for(var c=[],d=0;d<this.hits.length;d++)0!=(this.hits[d].gad.actionFlags&a)&&c.splice(c.length,0,this.hits[d].gad);return c}click(){for(var a=0;a<this.hits.length;a++)0!=(this.hits[a].gad.actionFlags&m.GAF_CLICKABLE)&&this.hits[a].gad.click&&
this.hits[a].gad.click.call(this.hits[a].gad)}menu(){for(var a=0;a<this.hits.length;a++)0!=(this.hits[a].gad.actionFlags&m.GAF_CONTEXTMENU)&&this.hits[a].gad.menu&&this.hits[a].gad.menu.call(this.hits[a].gad)}}class I{constructor(a,c){this.totalWidth=a;this.totalHeight=c;this.remainingY=this.remainingX=0;this.remainingWidth=a;this.remainingHeight=c}hasArea(){return 0<this.remainingWidth&&0<this.remainingHeight}clear(){this.remainingHeight=this.remainingWidth=this.remainingY=this.remainingX=0}}class U{constructor(a){this.name=
"unnamed";this.parent=a;this.designFit=void 0;this.sh=this.sw=this.H=this.W=this.h=this.w=this.y=this.x=this.designHeight=this.designWidth=this.designScale=this.designSize=0;this.userMat=mat4.create();mat4.identity(this.userMat);this.userY=this.userX=this.oy=this.ox=0;this.gadgets=[];this.mat=mat4.create();this.childRender=this.needsRender=!0}queueLayout(){-1===B.indexOf(this)&&B.push(this)}insideFit(a,c){this.viewScale=this.w/a<this.h/c?this.w/a:this.h/c}layoutAll(a){this.x=a.remainingX;this.y=a.remainingY;
this.w=a.remainingWidth;this.h=a.remainingHeight;this.W=a.totalWidth;this.H=a.totalHeight;this.viewScale=this.designFit?0==this.h?1:this.designFit[0]/this.designFit[1]>this.w/this.h?0==this.w?1:this.w/this.designFit[0]:0==this.h?1:this.h/this.designFit[1]:this.designSize?0!=this.w&&0!=this.h?Math.sqrt(this.w*this.h/this.designSize):1:this.designScale?this.designScale:this.designWidth?0==this.w?1:this.w/this.designWidth:this.designHeight?0==this.h?1:this.h/this.designHeight:this.parent?this.parent.viewScale:
1;0==this.viewScale&&(console.log("ZERO SCALE",this.name),this.viewScale=1);this.sw=this.w/this.viewScale;this.sh=this.h/this.viewScale;this.rematrix();this.layoutFunc&&(this.layoutFunc.call(this),this.rematrix());this.setRenderFlag(!0)}rematrix(){mat4.copy(this.mat,O);mat4.scale(this.mat,O,[w.width/this.w,w.height/this.h,1]);mat4.multiply(this.mat,this.mat,this.userMat);mat4.translate(this.mat,this.mat,[this.ox,this.oy,0]);mat4.scale(this.mat,this.mat,[this.viewScale,this.viewScale,1]);mat4.translate(this.mat,
this.mat,[-this.userX,-this.userY,0])}getRawMatrix(){return O}relayout(){if(this.w||this.h){var a=new I;a.totalWidth=this.W;a.totalHeight=this.H;a.remainingX=this.x;a.remainingY=this.y;a.remainingWidth=this.w;a.remainingHeight=this.h;this.layoutAll(a)}}getScale(){return this.viewScale}setRenderFlag(a){this.needsRender||(this.needsRender=this.needsender||a,this.childRender=!0,this.parent&&this.parent.setRenderFlag(!1),a&&this.a&&this.a.setRenderFlag(!0),a&&this.b&&this.b.setRenderFlag(!0),a&&this.c&&
this.c.setRenderFlag(!0))}renderAll(a=!0){this.childRender=!1;this.needsRender&&(this.needsRender=!1,0<this.w&&0<this.h&&(this.clip(),a&&(k.clearColor(0,0,0,1),k.clear(k.COLOR_BUFFER_BIT)),this.renderFunc&&this.renderFunc.call(this)))}clip(){k.viewport(this.x,this.H-this.y-this.h,this.w,this.h);k.scissor(this.x,this.H-this.y-this.h,this.w,this.h);k.enable(k.SCISSOR_TEST)}prepMatrix(){m.projMat&&m.viewMat&&(mat4.identity(m.projMat),mat4.translate(m.projMat,m.projMat,[-1,1,0]),mat4.scale(m.projMat,
m.projMat,[2/this.w,-2/this.h,1]),mat4.identity(m.viewMat),mat4.scale(m.viewMat,m.viewMat,[this.getScale(),this.getScale(),1]),mat4.translate(m.viewMat,m.viewMat,[-this.panX,-this.panY,0]))}getHits(a,c){if(!(0>=this.w||0>=this.h||a.x<this.x-c||a.y<this.y-c||a.x>=this.x+this.w+c||a.y>=this.y+this.h+c))for(const d of this.gadgets)d?d.getHits(a,c):console.log("Bad gadget",this)}}class Ea extends U{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.size=f;this.ratio=
d;this.threshold=1;this.ratioMin={h:0,v:0};this.ratioMax={h:1,v:1};this.c=this.b=this.a=void 0;this.prevTime=0}layoutAll(a){super.layoutAll(a);var c=new I(a.totalWidth,a.totalHeight),d=new I(a.totalWidth,a.totalHeight),f=new I(a.totalWidth,a.totalHeight);if(a.hasArea()){this.layoutBeginFunc&&this.layoutBeginFunc.call(this);var b=~~(this.size*this.getScale()),g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth/this.threshold>a.remainingHeight?!0:!1;this.state=this.stateNew="a"==this.type?
e?"v":"h":this.type}e=this.ratio;if("a"==this.type){var h=0,l=Date.now();0!=this.prevTime&&(h=l-this.prevTime);this.prevTime=l;17<h&&(h=17);a.remainingWidth/this.threshold>a.remainingHeight+2&&(this.stateNew="v");a.remainingWidth/this.threshold<a.remainingHeight+2&&(this.stateNew="h");if(this.stateNew!=this.state||0<this.stateProg)this.stateNew!=this.state?(this.stateProg+=.008*h,1<=this.stateProg&&(this.stateProg=1,this.state=this.stateNew,this.setPoint&&this.stateNew in this.setPoint&&(this.ratio=
this.setPoint[this.stateNew])),-1===B.indexOf(this)&&B.push(this)):(this.stateProg-=.008*h,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===B.indexOf(this)&&B.push(this));h="v"==this.state?"h":"v";this.setPoint&&h in this.setPoint&&(e=this.setPoint[h])}this.layoutFunc&&this.state!=g&&this.layoutFunc.call(this);g=Math.min(Math.max(this.ratio,this.ratioMin[this.state]),this.ratioMax[this.state]);g!=this.ratio&&(this.ratio=g,-1===B.indexOf(this)&&B.push(this));g=1-this.stateProg*(1-e);e=1-
this.stateProg*(0+e);"v"==this.state?(h=~~((a.remainingWidth-b)*this.ratio),c.remainingWidth=h,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX,c.remainingY=a.remainingY,d.remainingWidth=a.remainingWidth-b-h,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+h+b,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight,f.remainingX=a.remainingX+h,f.remainingY=a.remainingY,f.remainingWidth=b,f.remainingHeight=a.remainingHeight):"h"==this.state&&(h=~~((a.remainingHeight-
b)*this.ratio),c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=h,c.remainingX=a.remainingX,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-b-h,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth,d.remainingY=a.remainingY+h+b,f.remainingX=a.remainingX,f.remainingY=a.remainingY+h,f.remainingWidth=a.remainingWidth,f.remainingHeight=b)}else c.clear(),d.clear(),f.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d);this.c&&
this.c.layoutAll(f);this.layoutEndFunc&&this.layoutEndFunc.call(this);g=Math.min(Math.max(this.ratio,this.ratioMin[this.state]),this.ratioMax[this.state]);g!=this.ratio&&(this.ratio=g,-1===B.indexOf(this)&&B.push(this))}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll();this.c&&(this.c.needsRender||this.c.childRender)&&this.c.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&
this.b.getHits(a,c);this.c&&this.c.getHits(a,c)}}class Fa extends U{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.sizeH=d;this.sizeV=f?f:d;this.prop=!1;this.threshold=.5;this.b=this.a=void 0;this.prevTime=0;this.tallState=this.wideState="";"t l r b tl tr bl br".split(" ").includes(this.type)||console.error("Warning: Invalid 'type' for SliceView.")}layoutAll(a){super.layoutAll(a);var c=new I(a.totalWidth,a.totalHeight),d=new I(a.totalWidth,a.totalHeight);
if(a.hasArea()){var f=~~(this.sizeH*(this.prop?this.w:this.getScale())),b=~~(this.sizeV*(this.prop?this.h:this.getScale())),g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)?!0:!1;"tl"==this.type?(this.wideState="l",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"tr"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"bl"==this.type?(this.wideState="l",this.tallState="b",
this.stateNew=e?this.wideState:this.tallState):"br"==this.type?(this.wideState="r",this.tallState="b",this.stateNew=e?this.wideState:this.tallState):this.stateNew=this.type;this.state=this.stateNew}if(1<this.type.length){e=0;var h=Date.now();0!=this.prevTime&&(e=h-this.prevTime);this.prevTime=h;17<e&&(e=17);a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)+2&&(this.stateNew=this.wideState);a.remainingHeight*this.threshold>a.remainingWidth*(1-this.threshold)+2&&(this.stateNew=this.tallState);
if(this.stateNew!=this.state||0<this.stateProg)this.stateNew!=this.state?(this.stateProg+=.008*e,1<=this.stateProg&&(this.stateProg=1,this.state=this.stateNew),-1===B.indexOf(this)&&B.push(this)):(this.stateProg-=.008*e,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===B.indexOf(this)&&B.push(this))}this.layoutFunc&&this.state!=g&&0<this.w&&0<this.h&&this.layoutFunc.call(this);e="t"==this.state||"b"==this.state?b/a.remainingWidth:f/a.remainingHeight;g=1-this.stateProg*(1-e);e=1-this.stateProg*
(0+e);"l"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+b,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"r"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=
a.remainingX+a.remainingWidth-b,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"t"==this.state?(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-
f,d.remainingY=a.remainingY+f,"l"==this.wideState?(c.remainingX=a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX)):"b"==this.state&&(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY+a.remainingHeight-f,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY,"l"==this.wideState?(c.remainingX=a.remainingX,
d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX))}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Ga extends U{constructor(a,
c){super(a);this.type=c;this.indexProg=this.indexNew=this.index=0;this.b=this.a=void 0;this.pages=[];this.snaps=[];this.prevTime=0;this.keepPageFlag=!1;this.gadgets.push(this.swipeGad=new m.SwipeGadget(this));switch(this.type){case "h":this.swipeGad.actionFlags=m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT;break;case "v":this.swipeGad.actionFlags=m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN;break;default:this.swipeGad.actionFlags=0}this.layoutFunc=function(){0!=this.pages.length&&(this.minX=
0,this.maxX=this.sw*this.pages.length,this.minY=0,this.maxY=this.sh*this.pages.length,this.swipeGad.layout.call(this.swipeGad))};this.layoutPageFunc=function(){this.sw=this.parent.sw;this.sh=this.parent.sh;this.layoutFunc_&&this.layoutFunc_()};this.toPage=function(d){var f=this.swipeGad;d=Math.min(Math.max(d,0),this.pages.length);d>this.index?f.doSwipe(!0,d):d<this.index&&f.doSwipe(!1,d)}}keepPage(){this.keepPageFlag=!0}getPageIndex(a){for(var c=0;c<this.pages.length;c++)if(this.pages[c]===a)return c;
return-1}getPageOffset(a){return"h"==this.type?this.userX-a*this.sw:this.userY-a*this.sh}layoutAll(a){super.layoutAll(a);if(0!=this.pages.length){var c=new I(a.totalWidth,a.totalHeight),d=new I(a.totalWidth,a.totalHeight);if(a.hasArea()){this.prevTime=Date.now();var f="h"==this.type,b="v"==this.type;this.snaps=[];for(var g=0;g<this.pages.length;g++)this.snaps.push([this.sw*g*(f?1:0),this.sh*g*(b?1:0)]);if(this.viewScale!=this.prevScale||this.keepPageFlag)this.userX=this.index*this.sw,this.prevScale=
this.viewScale,this.keepPageFlag=!1;var e=this.index;g=!1;f&&(this.index=Math.min(Math.max(Math.round(this.userX/this.sw),0),this.pages.length-1));b&&(this.index=Math.min(Math.max(Math.round(this.userY/this.sh),0),this.pages.length-1));this.index!=e&&this.pageChangeFunc&&(g=!0,this.pageChangeFunc.call(this));e=this.pages[this.index];var h=this.userX+(f?-this.index*this.sw:0),l=this.userY+(b?-this.index*this.sh:0),n=void 0;if(f&&this.index*this.sw>this.userX||b&&this.index*this.sh>this.userY){f&&(e.userX=
0);b&&(e.userY=0);var q=this.index-1;if(0<=q&&q<this.pages.length){n=this.pages[q];q=this.userX+(f?-this.index*this.sw+this.sw:0);var r=this.userY+(b?-this.index*this.sh+this.sh:0);f&&(n.userX=f?q*this.viewScale/n.viewScale:0);b&&(n.userY=b?r*this.viewScale/n.viewScale:0)}}else f&&this.index*this.sw<this.userX||b&&this.index*this.sh<this.userY?(f&&(e.userX=f?h*this.viewScale/e.viewScale:0),b&&(e.userY=b?l*this.viewScale/e.viewScale:0),q=this.index+1,0<=q&&q<this.pages.length&&(n=this.pages[q],f&&
(n.userX=0),b&&(n.userY=0))):(f&&(e.userX=0),b&&(e.userY=0));this.a=e;e.parent=this;if(this.b=n)n.parent=this;this.a&&this.a.layoutFunc!==this.layoutPageFunc&&(this.a.layoutFunc&&(this.a.layoutFunc_=this.a.layoutFunc),this.a.layoutFunc=this.layoutPageFunc);this.b&&this.b.layoutFunc!==this.layoutPageFunc&&(this.b.layoutFunc&&(this.b.layoutFunc_=this.b.layoutFunc),this.b.layoutFunc=this.layoutPageFunc);g&&(n.pageBlurFunc&&n.pageBlurFunc(),e.pageFocusFunc&&e.pageFocusFunc());h=Math.round(h*this.viewScale);
l=Math.round(l*this.viewScale);c.remainingWidth=Math.min(Math.max(a.remainingWidth-Math.abs(h),0),a.remainingWidth);c.remainingHeight=Math.min(Math.max(a.remainingHeight-Math.abs(l),0),a.remainingHeight);c.remainingX=Math.min(Math.max(a.remainingX-(0>h?h:0),a.remainingX),a.remainingX+a.remainingWidth);c.remainingY=Math.min(Math.max(a.remainingY-(0>l?l:0),a.remainingY),a.remainingY+a.remainingHeight);n?f?(d.remainingWidth=a.remainingWidth-c.remainingWidth,d.remainingHeight=a.remainingHeight,d.remainingX=
a.remainingX,d.remainingY=a.remainingY,c.remainingX==a.remainingX&&(d.remainingX+=c.remainingWidth)):b&&(d.remainingWidth=a.remainingWidth,d.remainingHeight=a.remainingHeight-c.remainingHeight,d.remainingX=a.remainingX,d.remainingY=a.remainingY,c.remainingY==a.remainingY&&(d.remainingY+=c.remainingHeight)):d.clear()}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&
(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){super.getHits(a,c);this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Ha extends U{constructor(a,c,d,f){super(a);this.type=c;this.stateNew=this.state="";this.stateProg=0;this.sizeH=d;this.sizeV=f?f:d;this.prop=!1;this.threshold=.5;this.b=this.a=void 0;this.prevTime=0;this.tallState=this.wideState=""}layoutAll(a){super.layoutAll(a);var c=new I(a.totalWidth,a.totalHeight),d=new I(a.totalWidth,a.totalHeight);if(a.hasArea()){var f=
~~(this.sizeH*(this.prop?this.w:this.getScale())),b=~~(this.sizeV*(this.prop?this.h:this.getScale())),g=this.stateNew;if(""==this.stateNew){var e=a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)?!0:!1;"tl"==this.type?(this.wideState="l",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"tr"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):"bl"==this.type?(this.wideState="l",this.tallState="b",this.stateNew=e?this.wideState:
this.tallState):"br"==this.type?(this.wideState="r",this.tallState="t",this.stateNew=e?this.wideState:this.tallState):this.stateNew=this.type;this.state=this.stateNew}if(1<this.type.length){e=0;var h=Date.now();0!=this.prevTime&&(e=h-this.prevTime);this.prevTime=h;17<e&&(e=17);a.remainingWidth*this.threshold>a.remainingHeight*(1-this.threshold)+2&&(this.stateNew=this.wideState);a.remainingHeight*this.threshold>a.remainingWidth*(1-this.threshold)+2&&(this.stateNew=this.tallState);if(this.stateNew!=
this.state||0<this.stateProg)this.stateNew!=this.state?(this.stateProg+=.008*e,1<=this.stateProg&&(this.stateProg=1,this.state=this.stateNew),-1===B.indexOf(this)&&B.push(this)):(this.stateProg-=.008*e,0>this.stateProg&&(this.stateProg=0),0<this.stateProg&&-1===B.indexOf(this)&&B.push(this))}this.layoutFunc&&this.state!=g&&0<this.w&&0<this.h&&this.layoutFunc.call(this);e="t"==this.state||"b"==this.state?b/a.remainingWidth:f/a.remainingHeight;g=1-this.stateProg*(1-e);e=1-this.stateProg*(0+e);"l"==
this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX+b,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"r"==this.state?(c.remainingWidth=b,c.remainingHeight=~~(a.remainingHeight*g),c.remainingX=a.remainingX+
a.remainingWidth-b,d.remainingWidth=a.remainingWidth-b,d.remainingHeight=~~(a.remainingHeight*e),d.remainingX=a.remainingX,"t"==this.tallState?(c.remainingY=a.remainingY,d.remainingY=a.remainingY+a.remainingHeight-d.remainingHeight):(c.remainingY=a.remainingY+a.remainingHeight-c.remainingHeight,d.remainingY=a.remainingY)):"t"==this.state?(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-
f,d.remainingY=a.remainingY+f,"l"==this.wideState?(c.remainingX=a.remainingX,d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX)):"b"==this.state&&(c.remainingWidth=~~(a.remainingWidth*g),c.remainingHeight=f,c.remainingY=a.remainingY+a.remainingHeight-f,d.remainingWidth=~~(a.remainingWidth*e),d.remainingHeight=a.remainingHeight-f,d.remainingY=a.remainingY,"l"==this.wideState?(c.remainingX=a.remainingX,
d.remainingX=a.remainingX+a.remainingWidth-d.remainingWidth):(c.remainingX=a.remainingX+a.remainingWidth-c.remainingWidth,d.remainingX=a.remainingX))}else c.clear(),d.clear();this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}renderAll(){super.renderAll();this.a&&(this.a.needsRender||this.a.childRender)&&this.a.renderAll();this.b&&(this.b.needsRender||this.b.childRender)&&this.b.renderAll()}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Ia extends U{constructor(a){super(a);
this.b=this.a=void 0}layoutAll(a){super.layoutAll(a);this.layoutFunc&&this.layoutFunc.call(this);var c=new I(a.totalWidth,a.totalHeight),d=new I(a.totalWidth,a.totalHeight);c.remainingX=a.remainingX;c.remainingY=a.remainingY;c.remainingWidth=a.remainingWidth;c.remainingHeight=a.remainingHeight;d.remainingX=a.remainingX;d.remainingY=a.remainingY;d.remainingWidth=a.remainingWidth;d.remainingHeight=a.remainingHeight;this.a&&this.a.layoutAll(c);this.b&&this.b.layoutAll(d)}setRenderFlag(a){super.setRenderFlag(!0)}renderAll(){super.renderAll();
if(this.a&&(this.a.needsRender||this.a.childRender)||this.b&&(this.b.needsRender||this.b.childRender))this.b.renderAll(),this.a.renderAll(!1)}getHits(a,c){this.a&&this.a.getHits(a,c);this.b&&this.b.getHits(a,c)}}class Ca extends U{constructor(a){super(a);this.gadgets.push(a=new X(this));a.w=1E3;a.h=1E3;a.convexHull=a.computeHull([0,0,0,1E3,1E3,1E3,1E3,0]);a.click=function(){}}}class X{constructor(a){this.viewport=a;this.mat=mat4.create();mat4.identity(this.mat);this.H=this.h=this.w=this.y=this.x=
0;this.convexHull=[];this.extendedHulls={};this.boundingBoxes={};this.yo=this.xo=0;this.enabled=!0;this.selected=!1;this.actionFlags=0}getHits(a,c){if(this.enabled&&0!=this.convexHull.length){var d=this.viewport,f=vec3.create();mat4.getScaling(f,d.userMat);c=c/d.getScale()/f[0];f=""+c;f in this.extendedHulls||(this.computeExtendedHull(c),this.computeBoundingBox(c));c=this.extendedHulls[f];var b=this.boundingBoxes[f],g=1/d.getScale();f=vec3.create();f[0]=a.x-d.x-this.x/g;f[1]=a.y-d.y-this.y/g;var e=
mat4.create();mat4.invert(e,d.userMat);vec3.transformMat4(f,f,e);f=(a.x-d.x-d.ox)*g+d.userX-this.x-this.xo;d=(a.y-d.y-d.oy)*g+d.userY-this.y-this.yo;if(!(f<b.x1||f>=b.x2||d<b.y1||d>=b.y2)){g=c.length;b=!0;for(e=0;e<g;e+=2){var h=c[e+0];var l=c[e+1];h=(c[(e+2)%g]-h)*(d-l)-(c[(e+3)%g]-l)*(f-h);0>h&&(b=!1)}if(b){g=this.convexHull.length;b=!0;for(e=0;e<g;e+=2)c=this.convexHull[e+0],h=this.convexHull[e+1],h=(this.convexHull[(e+2)%g]-c)*(d-h)-(this.convexHull[(e+3)%g]-h)*(f-c),0>h&&(b=!1);c=0;b||(c=this.distToHull(f,
d));a.hits.push({gad:this,dist:c})}}}}autoHull(){this.convexHull=this.computeHull([0,0,this.w,0,this.w,this.h,0,this.h]);this.extendedHulls={};this.boundingBoxes={}}computeHull(a){function c(t,v,A,E,L,M){return(A-t)*(M-v)-(E-v)*(L-t)}function d(t){return t*t}function f(t,v,A,E,L,M){var H=d(A-L)+d(E-M);if(0==H)return d(t-A)+d(v-E);H=Math.max(0,Math.min(1,((t-A)*(L-A)+(v-E)*(M-E))/H));E+=H*(M-E);return d(t-(A+H*(L-A)))+d(v-E)}function b(t,v,A,E,L,M){if(!(2>v.length)){for(var H=0,R=0,y=0;y<~~(v.length/
2);y++){var S=Math.sqrt(f(v[2*y],v[2*y+1],A,E,L,M));S>R&&(R=S,H=y)}R=v[2*H];S=v[2*H+1];v.splice(2*H,2);for(y=0;y<~~(t.length/2);y++)if(t[2*y]==A&&t[2*y+1]==E&&t[(2*y+2)%t.length]==L&&t[(2*y+3)%t.length]==M||t[2*y]==L&&t[2*y+1]==M&&t[(2*y+2)%t.length]==A&&t[(2*y+3)%t.length]==E){t.splice(2*y+2,0,R,S);break}H=[];var Y=[];for(y=0;y<~~(v.length/2);y++)0>c(A,E,R,S,v[2*y],v[2*y+1])&&(H[H.length]=v[2*y],H[H.length]=v[2*y+1]),0>c(R,S,L,M,v[2*y],v[2*y+1])&&(Y[Y.length]=v[2*y],Y[Y.length]=v[2*y+1]);b(t,H,A,
E,R,S);b(t,Y,R,S,L,M)}}for(var g=[...a],e=[],h=0,l=0,n=g[0],q=g[0],r=0;r<~~(g.length/2);r++)g[2*r]<n&&(n=g[2*r],h=r),g[2*r]>q&&(q=g[2*r],l=r);e[e.length]=g[2*h];e[e.length]=g[2*h+1];e[e.length]=g[2*l];e[e.length]=g[2*l+1];g.splice(2*h,2);l<h?g.splice(2*l,2):g.splice(2*l-2,2);n=[];q=[];for(r=0;r<~~(g.length/2);r++)0>c(a[2*h],a[2*h+1],a[2*l],a[2*l+1],g[2*r],g[2*r+1])?(n[n.length]=g[2*r],n[n.length]=g[2*r+1]):(q[q.length]=g[2*r],q[q.length]=g[2*r+1]);b(e,n,a[2*h],a[2*h+1],a[2*l],a[2*l+1]);b(e,q,a[2*
l],a[2*l+1],a[2*h],a[2*h+1]);for(a=1;a;)for(r=a=0;r<~~(e.length/2);r++)if(.01>Math.sqrt(f(e[(2*r+2)%e.length],e[(2*r+3)%e.length],e[2*r],e[2*r+1],e[(2*r+4)%e.length],e[(2*r+5)%e.length]))){e.splice(2*r+2,2);a=1;break}return this.sortHull(e)}sortHull(a){function c(q){for(q=Math.atan2(a[q+1]-b,a[q+0]-f)-Math.atan2(l-b,h-f);q>Math.PI;)q-=2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;return q}for(var d=[],f=0,b=0,g=a.length,e=0;e<g;e+=2)f+=a[e+0],b+=a[e+1];f/=g/2;b/=g/2;for(var h=f+102,l=b+1;0<a.length;){g=
0;var n=c(0);for(e=0;e<a.length;e+=2)c(e)<n&&(g=e,n=c(e));d.push(a[g+0]);d.push(a[g+1]);a.splice(g,2)}return d}computeExtendedHull(a){for(var c=[],d=0,f=this.convexHull.length,b=0;b<f;b+=2){var g=this.convexHull[(b+3)%f]-this.convexHull[b+1],e=-(this.convexHull[(b+2)%f]-this.convexHull[b+0]),h=a/Math.sqrt(g*g+e*e);c[d+0]=this.convexHull[b+0]+g*h;c[d+1]=this.convexHull[b+1]+e*h;d+=2;c[d+0]=this.convexHull[(b+2)%f]+g*h;c[d+1]=this.convexHull[(b+3)%f]+e*h;d+=2}for(b=0;b<f;b+=2){g=this.convexHull[(b+
2)%f]-this.convexHull[b+0];e=this.convexHull[(b+3)%f]-this.convexHull[b+1];d=this.convexHull[(b-2+f)%f]-this.convexHull[b+0];var l=this.convexHull[(b-1+f)%f]-this.convexHull[b+1];h=Math.sqrt(g*g+e*e);l=Math.tan((Math.PI-Math.acos((g*d+e*l)/(h*Math.sqrt(d*d+l*l))))/4)*a;d=2*b;g=c[d+0]-c[d+2];e=c[d+1]-c[d+3];h=Math.sqrt(g*g+e*e);g=g*(h+l)/h;e=e*(h+l)/h;c[d+0]=g+c[d+2];c[d+1]=e+c[d+3];d=(b-2+f)%f*2;g=c[d+2]-c[d+0];e=c[d+3]-c[d+1];h=Math.sqrt(g*g+e*e);g=g*(h+l)/h;e=e*(h+l)/h;c[d+2]=g+c[d+0];c[d+3]=e+
c[d+1]}this.extendedHulls[""+a]=c}computeBoundingBox(a){this.boundingBoxes[""+a]={};var c=this.extendedHulls[""+a];a=this.boundingBoxes[""+a];if(!(2>c.length)){a.x1=c[0];a.x2=c[0];a.y1=c[1];a.y2=c[1];for(var d=2;d<c.length;d+=2)c[d+0]<a.x1&&(a.x1=c[d+0]),c[d+0]>a.x2&&(a.x2=c[d+0]),c[d+1]<a.y1&&(a.y1=c[d+1]),c[d+1]>a.y2&&(a.y2=c[d+1])}}distToHull(a,c){function d(l){return l*l}function f(l,n,q,r,t,v){var A=d(q-t)+d(r-v);if(0==A)return d(l-q)+d(n-r);A=Math.max(0,Math.min(1,((l-q)*(t-q)+(n-r)*(v-r))/
A));r+=A*(v-r);return d(l-(q+A*(t-q)))+d(n-r)}for(var b=this.convexHull,g=Math.sqrt(f(a,c,b[0],b[1],b[2],b[3])),e=2;e<b.length;e+=2){var h=Math.sqrt(f(a,c,b[e+0],b[e+1],b[(e+2)%b.length],b[(e+3)%b.length]));h<g&&(g=h)}return g}}class Ja extends X{constructor(a){super(a);this.dragBeginFunc=function(c){this.tempX=c.ox-this.viewport.x;this.tempY=c.oy-this.viewport.y};this.dragMoveFunc=function(c){var d=this.viewport.parent,f="h"==d.state,b=f?c.y-this.tempY-d.a.y:c.x-this.tempX-d.a.x;d.ratio=Math.max(0,
Math.min(1,b/(b+(f?d.y+d.h-(c.y-this.tempY+this.viewport.h):d.x+d.w-(c.x-this.tempX+this.viewport.w)))));d.setPoint||(d.setPoint={});d.setPoint[d.state]=d.ratio;-1===B.indexOf(this.viewport.parent)&&B.push(this.viewport.parent)};this.dragEndFunc=function(c){delete this.tempX;delete this.tempY}}layout(){var a=this.viewport,c=a.getScale(),d=a.parent.size,f="h"==a.parent.state;var b=f?Math.max(1,a.w)/c:d;a=f?d:Math.max(1,a.h)/c;this.actionFlags=f?m.GAF_DRAGGABLE_UPDOWN:m.GAF_DRAGGABLE_LEFTRIGHT;this.convexHull=
this.computeHull([0,0,0,a,b,a,b,0]);this.extendedHulls={};this.boundingBoxes={}}}class Ka extends X{getTargetMat(){return this.targetGad?this.targetGad.mat:this.targetView.userMat}constructor(a){super(a);this.targetView=a;this.targetGad=void 0;this.dragBeginFunc=function(c){var d=this.targetView;this.grab1b=vec3.create();this.grab1b[0]=c.x-d.x;this.grab1b[1]=c.y-d.y;this.viewMat=mat4.create();mat4.copy(this.viewMat,d.userMat);this.grabMat=mat4.create();mat4.copy(this.grabMat,this.getTargetMat());
c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(this.grab1b,this.grab1b,c);this.targetGad&&(c=mat4.create(),mat4.invert(c,this.grabMat),vec3.transformMat4(this.grab1b,this.grab1b,c))};this.dragMoveFunc=function(c){var d=this.targetView,f=vec3.create();f[0]=c.x-d.x;f[1]=c.y-d.y;c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(f,f,c);this.targetGad&&(c=mat4.create(),mat4.invert(c,this.grabMat),vec3.transformMat4(f,f,c));c=vec3.create();vec3.subtract(c,f,this.grab1b);this.targetGad&&
vec3.scale(c,c,1/d.getScale());mat4.translate(this.getTargetMat(),this.grabMat,c);d.rematrix();d.setRenderFlag(!0)};this.dragEndFunc=function(c){c=this.targetView;delete this.grab1b;delete this.viewMat;delete this.grabMat;c.setRenderFlag(!0)};this.pinchBeginFunc=function(c,d){var f=this.targetView;this.grab1=vec3.create();this.grab1[0]=c.x-f.x;this.grab1[1]=c.y-f.y;this.grab2=vec3.create();this.grab2[0]=d.x-f.x;this.grab2[1]=d.y-f.y;this.viewMat=mat4.create();mat4.copy(this.viewMat,f.userMat);this.grabMat=
mat4.create();mat4.copy(this.grabMat,this.getTargetMat());this.grabC=vec3.create();this.grab1b=vec3.create();vec3.copy(this.grab1b,this.grab1);this.grab2b=vec3.create();vec3.copy(this.grab2b,this.grab2);this.grabCb=vec3.create();c=mat4.create();mat4.invert(c,this.viewMat);vec3.transformMat4(this.grab1b,this.grab1b,c);vec3.transformMat4(this.grab2b,this.grab2b,c);this.targetGad&&(c=mat4.create(),mat4.copy(c,this.grabMat),vec3.transformMat4(this.grab1b,this.grab1b,c),vec3.transformMat4(this.grab2b,
this.grab2b,c));for(c=0;3>c;c++)this.grabC[c]=(this.grab1[c]+this.grab2[c])/2,this.grabCb[c]=(this.grab1b[c]+this.grab2b[c])/2;c=this.grab2[0]-this.grab1[0];d=this.grab2[1]-this.grab1[1];this.grabA=Math.atan2(d,c);this.grabM=Math.sqrt(c*c+d*d)};this.pinchMoveFunc=function(c,d){var f=this.targetView,b=vec3.create();b[0]=c.x-f.x;b[1]=c.y-f.y;c=vec3.create();c[0]=d.x-f.x;c[1]=d.y-f.y;var g=vec3.create(),e=vec3.create(),h=vec3.create();d=vec3.create();vec3.copy(e,b);vec3.copy(h,c);var l=mat4.create();
mat4.invert(l,this.viewMat);vec3.transformMat4(e,e,l);vec3.transformMat4(h,h,l);this.targetGad&&(l=mat4.create(),mat4.copy(l,this.grabMat),vec3.transformMat4(e,e,l),vec3.transformMat4(h,h,l));for(l=0;3>l;l++)g[l]=(b[l]+c[l])/2,d[l]=(e[l]+h[l])/2;g=c[0]-b[0];c=c[1]-b[1];b=Math.atan2(c,g);c=Math.sqrt(g*g+c*c);g=mat4.create();mat4.copy(g,this.grabMat);this.targetGad?(this.actionFlags&m.GAF_DRAGGABLE?mat4.translate(g,g,[d[0]/f.getScale(),d[1]/f.getScale(),0]):mat4.translate(g,g,[this.grabCb[0]/f.getScale(),
this.grabCb[1]/f.getScale(),0]),this.actionFlags&m.GAF_SCALABLE&&mat4.scale(g,g,[c/this.grabM,c/this.grabM,1]),this.actionFlags&m.GAF_ROTATABLE&&mat4.rotate(g,g,b-this.grabA,[0,0,1]),mat4.translate(g,g,[-this.grabCb[0]/f.getScale(),-this.grabCb[1]/f.getScale(),0])):(this.actionFlags&m.GAF_DRAGGABLE?mat4.translate(g,g,[d[0],d[1],0]):mat4.translate(g,g,[this.grabCb[0],this.grabCb[1],0]),this.actionFlags&m.GAF_SCALABLE&&mat4.scale(g,g,[c/this.grabM,c/this.grabM,1]),this.actionFlags&m.GAF_ROTATABLE&&
mat4.rotate(g,g,b-this.grabA,[0,0,1]),mat4.translate(g,g,[-this.grabCb[0],-this.grabCb[1],0]));f.rematrix();f.setRenderFlag(!0);mat4.copy(this.getTargetMat(),g)};this.pinchEndFunc=function(c,d){delete this.grab1;delete this.grab1b;delete this.grab2;delete this.grab2b;delete this.grabC;delete this.grabCb;delete this.grabA;delete this.grabM;delete this.grabMat};this.zoomFunc=function(c,d){const f=this.targetView,b=this.getTargetMat(),g=vec3.create();this.actionFlags&m.GAF_DRAGGABLE?(g[0]=c.x-f.x,g[1]=
c.y-f.y):mat4.getTranslation(g,b);c=mat4.create();mat4.invert(c,b);vec3.transformMat4(g,g,c);mat4.translate(b,b,[g[0],g[1],0]);mat4.scale(b,b,[Math.exp(d/10),Math.exp(d/10),1]);mat4.translate(b,b,[-g[0],-g[1],0]);f.rematrix();f.setRenderFlag(!0)};this.rotateFunc=function(c,d){const f=this.targetView,b=this.getTargetMat(),g=vec3.create();this.actionFlags&m.GAF_DRAGGABLE?(g[0]=c.x-f.x,g[1]=c.y-f.y):mat4.getTranslation(g,b);c=mat4.create();mat4.invert(c,b);vec3.transformMat4(g,g,c);mat4.translate(b,
b,[g[0],g[1],0]);mat4.rotate(b,b,-Math.PI/18*d,[0,0,1]);mat4.translate(b,b,[-g[0],-g[1],0]);f.rematrix();f.setRenderFlag(!0)}}getHits(a,c){this.enabled&&(0==this.convexHull.length?a.hits.push({gad:this,dist:0}):super.getHits(a,c))}layout(){console.log("MatrixGadget::layout()")}}class La extends X{constructor(a){super(a);this.actionFlags=m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN;this.followUp=this.flingFar=!1;this.animState="";this.doSwipe=function(c,d){var f=this.viewport,b;void 0!==d&&(b=Math.min(Math.max(d,
0),f.snaps.length));this.actionFlags&(m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN)&&(f.tempVX=0,void 0===f.tempVY&&(f.tempVY=0),f.tempVY=c?Math.min(f.tempVY,-.001):Math.max(f.tempVY,.001),f.userY-=f.tempVY);this.actionFlags&(m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT)&&(void 0===f.tempVX&&(f.tempVX=0),f.tempVX=c?Math.min(f.tempVX,-.001):Math.max(f.tempVX,.001),f.tempVY=0,f.userX-=f.tempVX);this.followUp=!1;f.relayout();f.setRenderFlag(!0);this.swipeEndFunc(void 0,void 0!==d?f.snaps[b]:
void 0)};this.swipeBeginFunc=function(c){var d=this.viewport,f=d.getScale();this.actionFlags&(m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN)&&(this.tempY=(c.oy-d.y-d.oy)/f+d.userY);this.actionFlags&(m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT)&&(this.tempX=(c.ox-d.x-d.ox)/f+d.userX);this.followUp=!1};this.swipeMoveFunc=function(c){var d=this.viewport,f=d.getScale(),b=d.minX,g=Math.max(d.maxX-d.sw,b),e=d.minY,h=Math.max(d.maxY-d.sh,e);this.maxX&&(g=Math.min(g,this.maxX-d.sw));this.maxY&&
(h=Math.min(h,this.maxY-d.sh));switch(this.actionFlags&m.GAF_SWIPEABLE){case m.GAF_SWIPEABLE_UPDOWN:f=(c.y-d.y-d.oy)/f+d.userY-this.tempY;d.userY=Math.min(Math.max(d.userY-f,e),h);d.rematrix();this.layout();d.tempVX=0;d.tempVY=c.dy;break;case m.GAF_SWIPEABLE_LEFTRIGHT:var l=(c.x-d.x-d.ox)/f+d.userX-this.tempX;d.userX=Math.min(Math.max(d.userX-l,b),g);d.rematrix();this.layout();d.tempVX=c.dx;d.tempVY=0;break;case m.GAF_SWIPEABLE_UPDOWN|m.GAF_SWIPEABLE_LEFTRIGHT:l=(c.x-d.x-d.ox)/f+d.userX-this.tempX,
f=(c.y-d.y-d.oy)/f+d.userY-this.tempY,d.userX=Math.min(Math.max(d.userX-l,b),g),d.userY=Math.min(Math.max(d.userY-f,e),h),d.rematrix(),this.layout(),d.tempVX=c.dx,d.tempVY=c.dy}this.followUp=!1;d.relayout();d.setRenderFlag(!0)};this.swipeEndFunc=function(c,d){function f(h,l){var n=e.getScale(),q=h[0];h=h[1];var r=l[0];l=l[1];var t=Math.sqrt(r*r+l*l);var v=Math.floor(10*t);var A=(10*t-v)/10,E=(v+1)*v/2;0<t&&(q-=r/t*(E/10+A*v)*1E3/30/n,h-=l/t*(E/10+A*v)*1E3/30/n);return[q,h]}function b(h,l,n){h=vec2.fromValues(h[0],
h[1]);l=vec2.fromValues(-l[0],-l[1]);vec2.normalize(l,l);h=vec2.dot(h,l);var q="unset",r;if(n)for(r of n){var t=vec2.fromValues(r[0],r[1]);t=vec2.dot(t,l);t-=h;if(0<=t&&("unset"==q||t<q)){q=t;var v=r}}if("unset"!=q)return v;if(n)for(r of n)if(t=vec2.fromValues(r[0],r[1]),t=vec2.dot(t,l),t=Math.abs(t-h),"unset"==q||t<q)q=t,v=r;return v}function g(h,l){var n="unset",q;if(l)for(q of l)if(l=Math.sqrt((h[0]-q[0])**2+(h[1]-q[1])**2),"unset"==n||l<n){n=l;var r=q}return r}var e=this.viewport;.001>Math.abs(e.tempVX)&&
this.actionFlags&m.GAF_SWIPEABLE_LEFTRIGHT&&(e.tempVX=.001);.001>Math.abs(e.tempVY)&&this.actionFlags&m.GAF_SWIPEABLE_UPDOWN&&(e.tempVY=.001);delete this.tempX;delete this.tempY;this.targetRest=void 0;this.inflect=!1;this.animState="decel";e.snaps&&0<e.snaps.length&&(c=this.flingFar?f([e.userX,e.userY],[e.tempVX,e.tempVY]):b([e.userX,e.userY],[e.tempVX,e.tempVY],e.snaps),c=g(c,e.snaps),this.targetRest=d?d:c,c[0]<e.userX&&0<e.tempVX&&(this.animState="accel"),c[0]>e.userX&&0>e.tempVX&&(this.animState=
"accel"),c[1]<e.userY&&0<e.tempVY&&(this.animState="accel"),c[1]>e.userY&&0>e.tempVY&&(this.animState="accel"));e.origVX=e.tempVX;e.newX=e.userX;e.origVY=e.tempVY;e.newY=e.userY;e.magOrig=Math.sqrt(e.tempVX*e.tempVX+e.tempVY*e.tempVY);e.magCur=e.magOrig;this.followUp=!0;this.viewport.queueLayout()};this.followUpFunc=function(){if(this.followUp){var c=this.viewport;switch(this.animState){case "decel":this.coast(!1)&&(this.animState="done");break;case "accel":this.coast(!0)&&(this.animState="done");
break;default:this.followUp=!1}c.queueLayout()}};this.coast=function(c){var d=this.viewport,f=d.getScale(),b=d.minX,g=Math.max(d.maxX-d.sw,b),e=d.minY,h=Math.max(d.maxY-d.sh,e);this.maxX&&(g=Math.min(g,this.maxX-d.sw));this.maxY&&(h=Math.min(h,this.maxY-d.sh));var l=d.newX-1E3*d.tempVX/30/f;f=d.newY-1E3*d.tempVY/30/f;if(this.targetRest&&(c||this.inflect)&&(Math.sign(l-this.targetRest[0])!=Math.sign(d.newX-this.targetRest[0])||Math.sign(f-this.targetRest[1])!=Math.sign(d.newY-this.targetRest[1])))return delete d.newX,
delete d.newY,delete d.tempVX,delete d.tempVY,delete d.origVX,delete d.origVY,delete d.magOrig,delete d.magCur,this.actionFlags&(m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT)&&(d.userX=this.targetRest[0]),this.actionFlags&(m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN)&&(d.userY=this.targetRest[1]),!0;d.newX=l;d.newY=f;this.actionFlags&(m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT)&&(d.userX=Math.min(Math.max(l,b),g));this.actionFlags&(m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN)&&
(d.userY=Math.min(Math.max(f,e),h));c=c?d.magCur+.1:d.magCur-.1;if("decel"==this.animState&&Math.sign(c)!=Math.sign(d.magCur))if(this.targetRest)this.inflect=!0;else return delete d.newX,delete d.newY,delete d.tempVX,delete d.tempVY,delete d.origVX,delete d.origVY,delete d.magOrig,delete d.magCur,!0;d.magCur=c;d.tempVX=d.origVX/d.magOrig*d.magCur;d.tempVY=d.origVY/d.magOrig*d.magCur;return!1}}layout(){var a=this.viewport;0>=a.maxX-a.minX||0>=a.maxY-a.minY||0>=a.sw||0>=a.sh||(this.convexHull=this.computeHull([Math.min(a.minX,
0),Math.min(a.minY,0),Math.min(a.minX,0),Math.max(a.maxY,a.sh),Math.max(a.maxX,a.sw),Math.max(a.maxY,a.sh),Math.max(a.maxX,a.sw),Math.min(a.minY,0)]),this.extendedHulls={},this.boundingBoxes={},this.actionFlags&(m.GAF_SWIPEABLE_LEFTRIGHT|m.GAF_SCROLLABLE_LEFTRIGHT)&&(a.userX=Math.min(Math.max(a.userX,a.minX),Math.max(a.maxX-a.sw,a.minX))),this.actionFlags&(m.GAF_SWIPEABLE_UPDOWN|m.GAF_SCROLLABLE_UPDOWN)&&(a.userY=Math.min(Math.max(a.userY,a.minY),Math.max(a.maxY-a.sh,a.minY))),this.followUp&&this.followUpFunc&&
this.followUpFunc.call(this))}}let W=()=>{},Z=[];var x=new Ca;var ca=-1,na=0,ka=0,ja=0,za=0,u={};const Q=15*window.devicePixelRatio;return m={initialize:Aa,start:Ba,pushRoot:function(a){Z.push(x);x=a;x.queueLayout();V()},peekRoot:function(){return Z[Z.length-1]},popRoot:function(){x=Z.pop();x.queueLayout();V()},getRoot:function(){return x},setRoot:function(a){Z=[];x=a;x.queueLayout();V()},setDebugFlags:function(a,c){za=!!a;ka=!!c},setKeystrokeSound:function(a){W=a},getContext:function(){return k},
getPointerRadius:N,isMouseEnabled:function(){return qa},getInputGad:function(){return T},beginInput:ea,endInput:da,setImage:function(a){if(!J){var c=k.createShader(k.VERTEX_SHADER),d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"attribute vec2 aVertex;attribute vec2 aUV;varying vec2 vTex;uniform mat4 pm;uniform mat4 mm;uniform vec2 pos;void main(void) {  gl_Position = pm * mm * vec4(aVertex + pos, 0.0, 1.0);  vTex = aUV;}");k.shaderSource(d,"precision highp float;varying vec2 vTex;uniform sampler2D sampler0;void main(void){  gl_FragColor = texture2D(sampler0, vTex);}");
k.compileShader(c);k.compileShader(d);J=k.createProgram();k.attachShader(J,c);k.attachShader(J,d);k.linkProgram(J);k.useProgram(J);va=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,va);k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,0]),k.STATIC_DRAW);wa=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,wa);k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),k.STATIC_DRAW);ta=k.getAttribLocation(J,"aVertex");ua=k.getAttribLocation(J,"aUV");k.getUniformLocation(J,"pos")}sa=k.createTexture();
k.bindTexture(k.TEXTURE_2D,sa);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a);return sa},drawImage:function(a,c,d){k.useProgram(J);k.enableVertexAttribArray(ta);k.bindBuffer(k.ARRAY_BUFFER,va);k.vertexAttribPointer(ta,2,k.FLOAT,!1,0,0);k.enableVertexAttribArray(ua);
k.bindBuffer(k.ARRAY_BUFFER,wa);k.bindTexture(k.TEXTURE_2D,a);k.vertexAttribPointer(ua,2,k.FLOAT,!1,0,0);k.uniformMatrix4fv(k.getUniformLocation(J,"pm"),!1,c);k.uniformMatrix4fv(k.getUniformLocation(J,"mm"),!1,d);k.drawArrays(k.TRIANGLE_FAN,0,4)},beep:function(a=""){if(P)switch(a){case "qr-scan":P.setValueAtTime(2,G.currentTime);P.setValueAtTime(3,G.currentTime+.05);P.setValueAtTime(0,G.currentTime+.1);break;case "qr-part":P.setValueAtTime(2,G.currentTime);P.setValueAtTime(0,G.currentTime+.05);break;
case "click":ra.setValueAtTime(.1,G.currentTime);ra.setValueAtTime(0,G.currentTime+.001);break;default:P.setValueAtTime(1,G.currentTime),P.setValueAtTime(0,G.currentTime+.1)}},backAction:function(){var a=new m.HitList(x.w/2,x.h/2);x.getHits(a,Math.sqrt((x.w/2)**2+(x.h/2)**2));a.sortHits();for(const c of a.hits)a=c.gad,!a.ownedBy&&a.actionFlags&m.GAF_BACKNAV&&a.clickFunc&&a.clickFunc.call(a,void 0)},View:U,DividerView:Ea,SliceView:Fa,PagesView:Ga,PopupView:Ha,ViewOverlay:Ia,ViewPicker:Ca,Gadget:X,
MatrixGadget:Ka,SwipeGadget:La,MiddleDividerGadget:Ja,GAF_CLICKABLE:1,GAF_HOLDABLE:2,GAF_CONTEXTMENU:4,GAF_STRETCHABLE:8,GAF_DRAGGABLE_UPDOWN:16,GAF_DRAGGABLE_LEFTRIGHT:32,GAF_DRAGGABLE:48,GAF_SWIPEABLE_UPDOWN:64,GAF_SWIPEABLE_LEFTRIGHT:128,GAF_SWIPEABLE:192,GAF_SCROLLABLE_UPDOWN:256,GAF_SCROLLABLE_LEFTRIGHT:512,GAF_SCROLLABLE:768,GAF_SCALABLE:1024,GAF_ROTATABLE:2048,GAF_PINCHABLE:3072,GAF_NUMINPUT:4096,GAF_TEXTINPUT:8192,GAF_GONEXT:16384,GAF_BACKNAV:32768,GAF_ALL:3901,HitList:Da,LayoutState:I}}();
